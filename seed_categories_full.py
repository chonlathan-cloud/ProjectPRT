import uuid
from sqlalchemy import create_engine, text
from app.settings import settings

# --- CONFIGURATION ---
# ‡∏ñ‡πâ‡∏≤ Run ‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á local ‡πÅ‡∏•‡∏∞‡∏ï‡πà‡∏≠ Cloud SQL Proxy ‡πÉ‡∏ä‡πâ localhost
# DB_URL = "postgresql://prt_app:YOUR_PASSWORD@127.0.0.1:6543/prt"
# ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ env file ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å settings (‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
DB_URL = "postgresql://prt_app:Pao_122546@127.0.0.1:6543/prt" 

def seed_categories_full():
    print(f"üöÄ Connecting to database...")
    engine = create_engine(DB_URL)

    # ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏õ‡∏µ 2566 (Full List)
    # Format: (name_th, account_code, type)
    categories = [
        # --- ‡∏´‡∏°‡∏ß‡∏î 1: ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå (ASSET) ---
        ("‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÉ‡∏ô‡∏°‡∏∑‡∏≠ (Cash in hands)", "101011", "ASSET"),
        ("‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏î‡∏£‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢ (Petty Cash)", "101012", "ASSET"),
        ("‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å-‡∏á‡∏ö‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô (017-1-38327-3)", "102011", "ASSET"),
        ("‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å-‡∏ô‡∏≠‡∏Å‡∏á‡∏ö‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ (017-0-22753-7)", "102012", "ASSET"),
        ("‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å-‡∏ô‡∏≠‡∏Å‡∏á‡∏ö‡∏Ñ‡∏á‡∏Ñ‡∏•‡∏±‡∏á (‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô ‡∏£.‡∏£.‡∏û‡∏£‡∏∞‡∏õ‡∏£‡∏¥‡∏¢‡∏±‡∏ï‡∏¥)", "102013", "ASSET"),
        ("‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤", "10300", "ASSET"),
        ("‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ", "10400", "ASSET"),

        # --- ‡∏´‡∏°‡∏ß‡∏î 4: ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (REVENUE) ---
        ("‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏£‡∏∞‡∏õ‡∏£‡∏¥‡∏¢‡∏±‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏°‡∏Ø", "401011", "REVENUE"),
        ("‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏£‡∏∞‡∏õ‡∏£‡∏¥‡∏¢‡∏±‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏°‡∏Ø ‡∏ò‡∏£‡∏£‡∏°-‡∏ö‡∏≤‡∏•‡∏µ", "401012", "REVENUE"),
        ("‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏™‡∏°‡∏ó‡∏ö ‡πÇ‡∏Ñ‡∏ß‡∏¥‡∏î", "401013", "REVENUE"),
        ("‡πÅ‡∏°‡πà‡∏Å‡∏≠‡∏á‡∏ò‡∏£‡∏£‡∏°‡∏™‡∏ô‡∏≤‡∏°‡∏´‡∏•‡∏ß‡∏á ‡∏ô‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏µ‡πÄ‡∏î‡πà‡∏ô", "401021", "REVENUE"),
        ("‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ", "401022", "REVENUE"),
        ("‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ", "401023", "REVENUE"),
        ("‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢", "401024", "REVENUE"),

        # --- ‡∏´‡∏°‡∏ß‡∏î 5: ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (EXPENSE) ---
        ("‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏π", "501014", "EXPENSE"),
        ("‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°", "501024", "EXPENSE"),
        ("‡∏†‡∏±‡∏ï‡∏ï‡∏≤‡∏´‡∏≤‡∏£", "501033", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏´‡∏ô‡∏∞", "501043", "EXPENSE"),
        ("‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "501051", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏≤", "501064", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á", "501071", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô", "501083", "EXPENSE"),
        ("‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°", "501094", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "501102", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏π‡∏û‡∏¥‡πÄ‡∏®‡∏©", "501114", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏π‡∏ö‡∏≤‡∏•‡∏µ(‡πÄ‡∏™‡∏£‡∏¥‡∏°)", "501124", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏-‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå", "501131", "EXPENSE"),
        ("‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", "501141", "EXPENSE"),
        ("‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£", "501152", "EXPENSE"),
        ("‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ", "501163", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏π‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ó‡∏±‡∏Å‡∏©‡∏∞", "501172", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "501182", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Ñ‡∏£‡∏π‡∏ö‡∏ô‡∏î‡∏≠‡∏¢", "501194", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô", "501203", "EXPENSE"),
        ("‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤", "509", "EXPENSE"),
    ]

    with engine.connect() as conn:
        print(f"üì¶ Upserting {len(categories)} categories...")
        
        for name, code, cat_type in categories:
            # ‡πÉ‡∏ä‡πâ UPSERT: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Code ‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ Update ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Error Duplicate)
            sql = text("""
                INSERT INTO categories (id, name_th, account_code, type, is_active, created_by, created_at)
                VALUES (:id, :name, :code, :type, TRUE, 'system_seed', NOW())
                ON CONFLICT (account_code) DO UPDATE 
                SET name_th = EXCLUDED.name_th, 
                    type = EXCLUDED.type,
                    is_active = TRUE;
            """)
            
            conn.execute(sql, {
                "id": uuid.uuid4(),
                "name": name,
                "code": code,
                "type": cat_type
            })
            
        conn.commit()
        print("‚úÖ Success! Categories seeded/updated successfully.")

if __name__ == "__main__":
    seed_categories_full()