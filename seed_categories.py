import uuid
from sqlalchemy import create_engine, text
from app.settings import settings

# ‡πÉ‡∏ä‡πâ URL ‡∏à‡∏≤‡∏Å Settings ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡πÜ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏û
# ‡∏ñ‡πâ‡∏≤‡∏ï‡πà‡∏≠ Cloud SQL Proxy ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö localhost
DB_URL = "postgresql://prt_app:Pao_122546@127.0.0.1:6543/prt" 

def seed_categories():
    engine = create_engine(DB_URL)
    
    # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤
    # Format: (name_th, account_code, type)
    # type: 'EXPENSE' (‡∏´‡∏°‡∏ß‡∏î 5), 'REVENUE' (‡∏´‡∏°‡∏ß‡∏î 4)
    # ‡∏´‡∏°‡∏ß‡∏î 1 ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå ‡∏õ‡∏Å‡∏ï‡∏¥‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡πÉ‡∏ô Category ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ (P&L) 
    # ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ ‡∏ú‡∏°‡∏à‡∏∞‡πÉ‡∏™‡πà‡πÄ‡∏õ‡πá‡∏ô EXPENSE (‡πÉ‡∏ô‡πÄ‡∏ä‡∏¥‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£) ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
    
    categories = [
        # --- ‡∏´‡∏°‡∏ß‡∏î 5: ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (EXPENSE) ---
        ("‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏π", "501014", "EXPENSE"),
        ("‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°", "501024", "EXPENSE"),
        ("‡∏†‡∏±‡∏ï‡∏ï‡∏≤‡∏´‡∏≤‡∏£", "501033", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏´‡∏ô‡∏∞", "501043", "EXPENSE"),
        ("‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "501051", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏≤", "501064", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á", "501071", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô", "501083", "EXPENSE"),
        ("‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°", "501094", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "501102", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏π‡∏û‡∏¥‡πÄ‡∏®‡∏©", "501114", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏π‡∏ö‡∏≤‡∏•‡∏µ(‡πÄ‡∏™‡∏£‡∏¥‡∏°)", "501124", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏-‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå", "501131", "EXPENSE"),
        ("‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", "501141", "EXPENSE"),
        ("‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£", "501152", "EXPENSE"),
        ("‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ", "501163", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏π‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ó‡∏±‡∏Å‡∏©‡∏∞", "501172", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "501182", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Ñ‡∏£‡∏π‡∏ö‡∏ô‡∏î‡∏≠‡∏¢", "501194", "EXPENSE"),
        ("‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô", "501203", "EXPENSE"),
        ("‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤", "509", "EXPENSE"),

        # --- ‡∏´‡∏°‡∏ß‡∏î 4: ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (REVENUE) ---
        ("‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏£‡∏∞‡∏õ‡∏£‡∏¥‡∏¢‡∏±‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏°‡∏Ø", "401011", "REVENUE"),
        ("‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏£‡∏∞‡∏õ‡∏£‡∏¥‡∏¢‡∏±‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏°‡∏Ø ‡∏ò‡∏£‡∏£‡∏°-‡∏ö‡∏≤‡∏•‡∏µ", "401012", "REVENUE"),
        ("‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏™‡∏°‡∏ó‡∏ö ‡πÇ‡∏Ñ‡∏ß‡∏¥‡∏î", "401013", "REVENUE"),
        ("‡πÅ‡∏°‡πà‡∏Å‡∏≠‡∏á‡∏ò‡∏£‡∏£‡∏°‡∏™‡∏ô‡∏≤‡∏°‡∏´‡∏•‡∏ß‡∏á ‡∏ô‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏µ‡πÄ‡∏î‡πà‡∏ô", "401021", "REVENUE"),
        ("‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ", "401022", "REVENUE"),
        ("‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ", "401023", "REVENUE"),
        ("‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢", "401024", "REVENUE"),
    ]

    with engine.connect() as conn:
        print(f"üöÄ Inserting {len(categories)} categories...")
        
        for name, code, cat_type in categories:
            # ‡πÉ‡∏ä‡πâ SQL Upsert (‡∏•‡∏á‡∏ó‡∏±‡∏ö‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ error
            sql = text("""
                INSERT INTO categories (id, name_th, account_code, type, is_active, created_by, created_at)
                VALUES (:id, :name, :code, :type, TRUE, 'system_seed', NOW())
                ON CONFLICT (account_code) DO UPDATE 
                SET name_th = EXCLUDED.name_th, type = EXCLUDED.type;
            """)
            
            conn.execute(sql, {
                "id": uuid.uuid4(),
                "name": name,
                "code": code,
                "type": cat_type
            })
            
        conn.commit()
        print("‚úÖ Success! Categories seeded.")

if __name__ == "__main__":
    seed_categories()