import uuid
from datetime import date
from sqlalchemy import create_engine, text
from app.settings import settings

# --- CONFIGURATION ---
DB_URL = settings.DATABASE_URL 

def seed_data_2566():
    print(f"üöÄ Connecting to database...")
    engine = create_engine(DB_URL)

    # ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏™‡∏¥‡πâ‡∏ô‡∏õ‡∏µ 2566/2023)
    TX_DATE = date(2023, 12, 31)

    # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏µ 2566 (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏°‡∏≤)
    # Format: (Type, Category Name, Amount)
    # Type: 'income' ‡∏´‡∏£‡∏∑‡∏≠ 'expense'
    transactions = [
        # --- ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (Income) ---
        ("income", "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏£‡∏∞‡∏õ‡∏£‡∏¥‡∏¢‡∏±‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏°‡∏Ø", 6107253.00),
        # ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏£‡∏∞‡∏õ‡∏£‡∏¥‡∏¢‡∏±‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏°‡∏Ø ‡∏ò‡∏£‡∏£‡∏°-‡∏ö‡∏≤‡∏•‡∏µ -> ‡∏¢‡∏≠‡∏î 0 ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà
        # ‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏™‡∏°‡∏ó‡∏ö ‡πÇ‡∏Ñ‡∏ß‡∏¥‡∏î -> ‡∏¢‡∏≠‡∏î 0 ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà
        ("income", "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ", 217735.00),
        # ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ -> ‡∏¢‡∏≠‡∏î 0
        # ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ -> ‡∏¢‡∏≠‡∏î 0

        # --- ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (Expense) ---
        ("expense", "‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏π", 3439920.00),
        ("expense", "‡∏†‡∏±‡∏ï‡∏ï‡∏≤‡∏´‡∏≤‡∏£", 772584.50),
        ("expense", "‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏´‡∏ô‡∏∞", 125255.00),
        ("expense", "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", 317374.00),
        ("expense", "‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏≤", 744820.00),
        ("expense", "‡∏Ñ‡πà‡∏≤‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á", 179215.00),
        ("expense", "‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô", 314609.00),
        ("expense", "‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°", 57094.00),
        ("expense", "‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", 289134.00),
        ("expense", "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏π‡∏û‡∏¥‡πÄ‡∏®‡∏©", 645000.00),
        ("expense", "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏π‡∏ö‡∏≤‡∏•‡∏µ(‡πÄ‡∏™‡∏£‡∏¥‡∏°)", 53550.00),
        ("expense", "‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏-‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå", 50290.00),
        ("expense", "‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", 1006248.00),
        ("expense", "‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£", 131967.00),
        ("expense", "‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ", 309960.50),
        # ‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏π‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ó‡∏±‡∏Å‡∏©‡∏∞ -> ‡∏¢‡∏≠‡∏î 0
        ("expense", "‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", 13072.00),
        # ‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Ñ‡∏£‡∏π‡∏ö‡∏ô‡∏î‡∏≠‡∏¢ -> ‡∏¢‡∏≠‡∏î 0
        ("expense", "‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô", 210.00),
        
        # --- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏© ---
        ("expense", "‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤", 91100.00),
    ]

    with engine.connect() as conn:
        print(f"üì¶ Importing {len(transactions)} transactions for Year 2566...")
        
        # ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏õ‡∏µ 2566 (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏¥‡πâ‡∏•‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥
        # ‡∏•‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà created_by = 'system_seed_2566' ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô 2023-12-31
        clear_sql = text("""
            DELETE FROM transactions_v1 
            WHERE occurred_at = :tx_date 
            AND created_by = 'system_seed_2566'
        """)
        conn.execute(clear_sql, {"tx_date": TX_DATE})
        
        # Loop Insert
        for tx_type, cat_name, amount in transactions:
            # ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ Category ‡∏•‡∏á‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡πÜ (Flat Design)
            # ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πä‡∏∞ ‡∏≠‡∏≤‡∏à‡∏à‡∏∞ query ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ category ‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏´‡∏° (Optional)
            
            sql = text("""
                INSERT INTO transactions_v1 (id, type, category, amount, occurred_at, note, created_by, created_at)
                VALUES (:id, :type, :category, :amount, :occurred_at, :note, 'system_seed_2566', NOW())
            """)
            
            conn.execute(sql, {
                "id": uuid.uuid4(),
                "type": tx_type,
                "category": cat_name,
                "amount": amount,
                "occurred_at": TX_DATE,
                "note": f"‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏µ 2566 - {cat_name}"
            })
            
        conn.commit()
        print("‚úÖ Success! Data for 2566 imported successfully.")

if __name__ == "__main__":
    seed_data_2566()