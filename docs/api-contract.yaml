openapi: 3.0.3
info:
  title: ProjectPRT Phase 1 API Contract
  version: "1.0.0"
  description: Read-only dashboard, transaction creation, and Google SSO contracts.
paths:
  /api/v1/dashboard/summary:
    get:
      summary: Get dashboard summary
      operationId: getDashboardSummary
      responses:
        "200":
          description: Summary retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SummaryResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/v1/dashboard/monthly:
    get:
      summary: Get monthly dashboard data
      operationId: getDashboardMonthly
      responses:
        "200":
          description: Monthly data retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MonthlyResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/v1/transactions:
    post:
      summary: Create a transaction
      operationId: createTransaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TransactionCreateRequest"
      responses:
        "201":
          description: Transaction created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionCreateResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"
  /api/v1/auth/google:
    post:
      summary: Google SSO login
      operationId: authGoogle
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GoogleAuthRequest"
      responses:
        "200":
          description: Auth success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GoogleAuthResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalError"
components:
  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            bad_request:
              value:
                success: false
                data: null
                error:
                  code: BAD_REQUEST
                  message: Invalid input
                  details: {}
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            unauthorized:
              value:
                success: false
                data: null
                error:
                  code: UNAUTHORIZED
                  message: Missing or invalid credentials
                  details: {}
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            forbidden:
              value:
                success: false
                data: null
                error:
                  code: FORBIDDEN
                  message: Insufficient permissions
                  details: {}
    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            internal:
              value:
                success: false
                data: null
                error:
                  code: INTERNAL
                  message: Unexpected error
                  details: {}
  schemas:
    ResponseEnvelope:
      type: object
      required:
        - success
        - data
        - error
      properties:
        success:
          type: boolean
          description: Indicates if the request was successful.
        data:
          nullable: true
          description: Response payload when successful; null on error.
        error:
          nullable: true
          description: Error payload when unsuccessful; null on success.
    ErrorObject:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          enum:
            - BAD_REQUEST
            - UNAUTHORIZED
            - FORBIDDEN
            - NOT_FOUND
            - INTERNAL
        message:
          type: string
        details:
          type: object
          additionalProperties: true
          nullable: true
    ErrorResponse:
      allOf:
        - $ref: "#/components/schemas/ResponseEnvelope"
        - type: object
          properties:
            success:
              type: boolean
              enum: [false]
            data:
              type: "null"
            error:
              $ref: "#/components/schemas/ErrorObject"
    SummaryData:
      type: object
      required:
        - total_income
        - total_expense
        - balance
      properties:
        total_income:
          type: number
          format: double
        total_expense:
          type: number
          format: double
        balance:
          type: number
          format: double
    SummaryResponse:
      allOf:
        - $ref: "#/components/schemas/ResponseEnvelope"
        - type: object
          properties:
            success:
              type: boolean
              enum: [true]
            data:
              $ref: "#/components/schemas/SummaryData"
            error:
              type: "null"
    MonthlyItem:
      type: object
      required:
        - month
        - income
        - expense
      properties:
        month:
          type: string
          pattern: "^[0-9]{4}-[0-9]{2}$"
        income:
          type: number
          format: double
        expense:
          type: number
          format: double
    MonthlyResponse:
      allOf:
        - $ref: "#/components/schemas/ResponseEnvelope"
        - type: object
          properties:
            success:
              type: boolean
              enum: [true]
            data:
              type: array
              items:
                $ref: "#/components/schemas/MonthlyItem"
            error:
              type: "null"
    TransactionCreateRequest:
      type: object
      required:
        - type
        - category
        - amount
        - occurred_at
      properties:
        type:
          type: string
          enum:
            - income
            - expense
        category:
          type: string
        amount:
          type: number
          format: double
        occurred_at:
          type: string
          format: date
        note:
          type: string
          nullable: true
    TransactionCreateData:
      type: object
      required:
        - transaction_id
        - status
      properties:
        transaction_id:
          type: string
        status:
          type: string
          enum:
            - created
    TransactionCreateResponse:
      allOf:
        - $ref: "#/components/schemas/ResponseEnvelope"
        - type: object
          properties:
            success:
              type: boolean
              enum: [true]
            data:
              $ref: "#/components/schemas/TransactionCreateData"
            error:
              type: "null"
    GoogleAuthRequest:
      type: object
      required:
        - id_token
      properties:
        id_token:
          type: string
    GoogleUser:
      type: object
      required:
        - user_id
        - email
        - name
      properties:
        user_id:
          type: string
        email:
          type: string
          format: email
        name:
          type: string
    GoogleAuthData:
      type: object
      required:
        - access_token
        - user
      properties:
        access_token:
          type: string
        user:
          $ref: "#/components/schemas/GoogleUser"
    GoogleAuthResponse:
      allOf:
        - $ref: "#/components/schemas/ResponseEnvelope"
        - type: object
          properties:
            success:
              type: boolean
              enum: [true]
            data:
              $ref: "#/components/schemas/GoogleAuthData"
            error:
              type: "null"
